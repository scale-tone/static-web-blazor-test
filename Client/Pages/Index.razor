@page "/"
@using System.Text.Json
@using System.Text.Json.Serialization
@using System.Dynamic

@inject HttpClient client

<PageTitle>Index</PageTitle>

<h1>Hello, @userName</h1>
<br>
<button @onclick="OnTestBtnClick">Greet me</button>

@code {

    private string userName = "";

    class UserResponse
    {
        public class ClientPrincipal
        {
            public string userDetails { get; set; }
        }

        public ClientPrincipal clientPrincipal { get; set; }
    }

    private async Task OnTestBtnClick()
    {
        var response = await client.GetAsync("/.auth/me");

        using var responseStream = await response.Content.ReadAsStreamAsync();
        using var streamReader = new StreamReader(responseStream);

        string json = streamReader.ReadToEnd();

        var userInfo = JsonSerializer.Deserialize<UserResponse>(json);

        this.userName = json + "|" + userInfo?.clientPrincipal?.ToString() ?? "null" + "|" + userInfo?.clientPrincipal?.userDetails ?? "null";
    }
}